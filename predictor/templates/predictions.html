{% extends 'base.html' %}
{% block section-title %}
Games / <a href="{% url 'predictor.views.scores' %}" class="navbar-link active" style="color:#BBB">Scores</a>
<span class="pull-right">
{% if user %}<span style="font-size:.5em">{{ user.first_name|default:user.username }}</span>
<button class="btn btn-primary" role="button" onclick="$(this).prop('disabled', true);$('#form').submit();">Save Updates</button>{% endif %}
</span>
{% endblock %}
{% block maincontainer %}
<style>
.correct { background-color: #DFF0D8; border-color: #D6E9C6; }
.allpredictions{ display:none; font-size:.8em;}
.allpredictions td{border-top:none}
</style>

{% if updates_made %}
<div id="message" class="alert alert-success text-center">Updates were saved for {{ user.first_name|default:user.username }}</div>
<script type="text/javascript">
setTimeout(function(){$('#message').slideToggle('slow');},3000);
</script>
{% endif %}
<form method="post" id="form" autocomplete="off" >
{% csrf_token %}
<table class="table table-condensed table-hover">
{% for game in games %}
{% if game.id == 49 %}
<tr><td colspan="20">
	ROUND OF 16
</td>
</tr>{% endif %}
{% if game.id == 57 %}
<tr><td colspan="20">
	QUARTER FINALS
</td>
</tr>{% endif %}
{% if game.id == 61 %}
<tr><td colspan="20">
	SEMI FINALS
</td>
</tr>{% endif %}
{% if game.id == 63 %}
<tr><td colspan="20">
	PLAY-OFF FOR THIRD PLACE
</td>
</tr>{% endif %}
{% if game.id == 64 %}
<tr><td colspan="20">
	FINAL
</td>
</tr>{% endif %}

<tr id="{{game.id}}">
<td class="ptoggle hidden-xs" style="font-size:.8em;color:#444">{{ game.match_date }}</td>
<td class="ptoggle text-right"><label for="game{{ game.id }}_a">{{ game.team_a }}</label></td>

{% if game.open %}
<td class="text-center ignoreToggle"><select name="game{{ game.id }}_a" id="game{{ game.id }}_a">{% for i in "xxxxxxxxxx" %}<option value="{{ forloop.counter0 }}" {% if game.prediction.predict_a == forloop.counter0 %}selected="selected"{% endif %}>{{ forloop.counter0 }}</option>{% endfor %}</select></td>
<td>v</td>
<td class="text-center"><select name="game{{ game.id }}_b" >{% for i in "xxxxxxxxxx" %}<option value="{{ forloop.counter0 }}" {% if game.prediction.predict_b == forloop.counter0 %}selected="selected"{% endif %}>{{ forloop.counter0 }}</option>{% endfor %}</select></td>
{% else %}
{% if games.goals_a %}
<td class="ptoggle text-center{% if game.prediction.predict_a == game.goals_a %} correct{% endif %}">({{ game.prediction.predict_a }}) <strong>{{ game.goals_a }}</strong></td>
<td> v </td>
<td class="ptoggle text-center{% if game.prediction.predict_b == game.goals_b %} correct{% endif %}"><strong>{{ game.goals_b }}</strong> ({{ game.prediction.predict_b }})</td>
{% else %}

<td class="ptoggle text-center"></td>
<td> v </td>
<td class="ptoggle text-center"></td>


{% endif %}
{% endif %}

<td ><label for="game{{ game.id }}_b">{{ game.team_b }}</label></td>
<td title="points awarded">{% if game.prediction.points_awarded|yesno:"2,1," %}<strong>{{ game.prediction.points_awarded|floatformat:"0" }}</strong>{% endif %}</td>
</tr>
{% for p in game.allpredictions %}
<tr class="allpredictions{{game.id}} allpredictions" style="display:none">
<td class="hidden-xs"></td>
<td clas="text-right">{{ p.user.first_name }}</td>
<td class="text-center{% if game.goals_a and p.predict_a == game.goals_a %} correct{% endif %}">{{ p.predict_a }}</td>
<td></td>
<td class="text-center{% if game.goals_b and p.predict_b == game.goals_b %} correct{% endif %}">{{ p.predict_b }}</td>
<td></td>
<td>{{ p.points_awarded|floatformat:"0" }}</td>
</tr>
{% endfor %}
{% endfor %}
</table>
</form>

<script>
$(document).ready(
	function()
	{
		$('.ptoggle').on('click',function(evt)
				{
					$('.allpredictions'+$( this ).closest('tr').attr('id')).slideToggle();
				})
			.css('cursor','pointer');
               if($('select').length>0)
	       	window.scrollTo(0,$('select').first().position().top -60);
	});
</script>

{% endblock %}
